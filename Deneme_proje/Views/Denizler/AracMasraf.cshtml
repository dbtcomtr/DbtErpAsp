@model Deneme_proje.Models.DenizlerEntities.RaportViewModel
@{
    ViewData["Title"] = "Araç Masrafı Raporu";
    Layout = "~/Views/Shared/_Layout.cshtml";

    // Gelir ve gider hesaplamaları
    double gelir = (double)Model.Denizler1Data.Sum(x => x.NakliyeCiroBedeli);
    double gider = (double)Model.Denizler2Data.Sum(x => x.Tutar) + (double)Model.Denizler3Data.Sum(x => x.Tutar);
    double sonuc = gelir - gider;
    @inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor

}

<link href="~/content/assets/css/bahcepinar.css" rel="stylesheet" />
<link href="~/content/assets/css/site.css" rel="stylesheet" />
<style>
    table.dataTable tbody th, table.dataTable tbody td {
        padding: 5px 21px !important;
    }

    @@media only screen and (max-width: 576px) {
        .form-inline .btn {
            margin-top: 0;
        }
    }

    html, body {
        height: 100%;
        margin: 0;
    }

    .table {
        margin-bottom: 0rem;
    }

    .content-inner {
        padding: 0px !important;
    }

    .column-width {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: wrap;
        padding: 5px;
        max-width: 100%;
        width: 100%;
    }

    .table-responsive th, .table-responsive td {
        padding: 2px 10px;
    }

    .tablo-th-baslik th {
        color: black;
        font-weight: bold;
    }

    .table-striped > tbody > tr:nth-of-type(even) > th {
        font-weight: bold;
        color: black !important;
    }

    form {
        box-shadow: 0 8px 8px rgba(0, 0, 0, 0.3);
    }

    .table-container {
        width: 100%;
    }

    .table-responsive table {
        font-size: 9px;
        table-layout: fixed;
    }

    .table-container .table .masraf-adı-cell {
        max-width: 100px;
        font-size: 0.75em;
    }

    .table-container td, .table-container th {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        padding: 5px;
        max-width: 100px;
    }

    .container-fluid {
        padding: 0 15px;
    }

    .row {
        margin: 0;
    }

    .col-md-3, .col-md-6, .col-md-12 {
        padding: 0 5px;
    }

    .form-group {
        margin-bottom: 10px;
    }

    .btn {
        font-size: 0.75em;
        padding: 5px 8px;
    }

    .card-header, .card-body {
        padding: 10px;
    }

    .header-title h4 {
        font-size: 1.2em;
    }

    .filtre {
        height: 20px;
        font-size: 10px;
    }

    @@media print {
        table {
            width: 100%;
            font-size: 12px !important;
            font-family: Arial, sans-serif;
            border-collapse: collapse;
            table-layout: fixed;
            margin-bottom: 5px !important; /* Reduced margin between tables */
        }

        td, th {
            padding: 2px 5px !important; /* Minimal padding for cells */
            line-height: 1.2;
            border: 1px solid #E5E7EB;
            font-size: 12px !important;
        }

        th {
            background-color: #F3F4F6;
            color: #1E3A8A;
            font-weight: bold;
        }

        .table-striped > tbody > tr:last-child {
            background-color: #FFF7ED;
            font-weight: bold;
        }

            .table-striped > tbody > tr:last-child td {
                color: #B8860B;
                font-size: 8px !important;
            }

        h5 {
            font-size: 12px !important;
            color: #B8860B;
            margin: 4px 0 !important; /* Reduced margin for headings */
        }

        h3 {
            font-size: 15px !important;
            color: #1E3A8A;
            margin: 5px 0 !important; /* Reduced margin for headings */
        }

        .print-header {
            display: block !important;
            text-align: center;
            margin-bottom: 8px !important; /* Reduced margin */
            border-bottom: 2px solid #1E3A8A;
            padding-bottom: 3px !important; /* Reduced padding */
        }

            .print-header h3 {
                font-size: 8pt !important;
                color: #1E3A8A;
                font-weight: bold;
                margin: 0 !important;
            }

            .print-header p {
                font-size: 6pt !important;
                color: #374151;
                margin: 2px 0 !important;
            }

        .no-print {
            display: none !important;
        }

        .main-content {
            margin-top: 0 !important;
        }

        .card-header, .form-group, .btn {
            display: none !important;
        }

        .card {
            box-shadow: none !important;
            border: none !important;
        }

        .table-container, .table-responsive {
            page-break-inside: avoid;
            margin-bottom: 5px !important; /* Reduced margin for table containers */
            padding: 0 !important; /* Remove padding */
        }

            .table-container td, .table-container th {
                max-width: 100px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
    }
    
</style>

<!-- HTML içeriği aynı kaldı -->
<div class="main-content mt-5">
    <div class="px-lg-5 px-3">
        <div class="row no-print">
            <div class="col-sm-12 p-0 no-print">
                <div class="main-header">
                    <ol class="breadcrumb breadcrumb-title breadcrumb-arrow">
                        <li class="breadcrumb-item">
                            <a href="/Home/Index"><i class="icofont icofont-home"></i></a>
                        </li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- Print-only header -->
        <div class="print-header" style="display: none;">
            <h3>Araç Masrafı Raporu</h3>
            <p><strong>Sorumlu Kodu:</strong> <span id="printSrmKodu">@(string.IsNullOrEmpty(HttpContextAccessor.HttpContext.Request.Query["srmKodu"]) ? "Seçilmedi" : HttpContextAccessor.HttpContext.Request.Query["srmKodu"])</span></p>
            <p><strong>Başlama Tarihi:</strong> <span id="printBaslamaTarihi">@Model.BaslamaTarihi.ToString("dd.MM.yyyy")</span></p>
            <p><strong>Bitiş Tarihi:</strong> <span id="printBitisTarihi">@Model.BitisTarihi.ToString("dd.MM.yyyy")</span></p>
            <p><strong>Proje Kodu:</strong> <span id="printProjeKodu">@(string.IsNullOrEmpty(HttpContextAccessor.HttpContext.Request.Query["projeKodu"]) ? "Seçilmedi" : HttpContextAccessor.HttpContext.Request.Query["projeKodu"])</span></p>
        </div>

        <div class="row mb-lg-5 mb-1">
            <div class="card">
                <div class="card-header d-flex justify-content-between"></div>
                <div class="row d-flex justify-content-center">
                    <div class="col-md-4 d-flex flex-column justify-content-center">
                        <form id="veri" method="get" class="mb-4 px-5 pt-5">
                            <div class="header-title">
                                <h4 class="card-title px-4">Araç Masrafı Raporu</h4>
                            </div>
                            <div class="row d-flex flex-column mb-3">
                                <div class="form-group col">
                                    <label for="baslamaTarihi">Başlama Tarihi:</label>
                                    <input type="date" id="baslamaTarihi" name="baslamaTarihi" class="form-control form-control-sm" required value="@Model.BaslamaTarihi.ToString("yyyy-MM-dd")" />
                                </div>
                                <div class="form-group col">
                                    <label for="bitisTarihi">Bitiş Tarihi:</label>
                                    <input type="date" id="bitisTarihi" name="bitisTarihi" class="form-control form-control-sm" required value="@Model.BitisTarihi.ToString("yyyy-MM-dd")" />
                                </div>
                                <div class="form-group col">
                                    <label for="projeKoduInput">Proje Kodu:</label>
                                    <input type="text" id="projeKoduInput" name="projeKodu" class="form-control form-control-sm" list="projeKoduList" placeholder="Proje Kodu / Adı Ara..." />
                                    <datalist id="projeKoduList">
                                        @foreach (var item in Model.ProjeKodlari)
                                        {
                                            <option value="@item.Value">@item.Text</option>
                                        }
                                    </datalist>
                                </div>
                                <div class="form-group col">
                                    <label for="srmKodu">Sorumlu Kodu:</label>
                                    <input type="text" id="srmKodu" name="srmKodu" class="form-control form-control-sm" list="srmKoduList" placeholder="Sorumlu Kodu Ara..." />
                                    <datalist id="srmKoduList">
                                        @foreach (var item in Model.SorumluKodlari)
                                        {
                                            <option value="@item.Value">@item.Text</option>
                                        }
                                    </datalist>
                                </div>
                                <div class="form-group col-md-12 text-right mt-3">
                                    <button type="submit" class="btn btn-primary btn-sm">Verileri Getir</button>
                                    <button type="button" id="resetButton" class="btn btn-secondary btn-sm ml-2">Seçimleri Sıfırla</button>
                                    <div class="text-right no-print">
                                        <button class="btn btn-success" onclick="window.print()">Yazdır</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="col-md-8">
                        <div class="table-container d-flex justify-content-center">
                            <div class="table-responsive me-3">
                                <h5>Detay Rapor</h5>
                                <table id="denizler1tablo" class="table table-bordered table-striped tablo-th-baslik">
                                    <tbody>
                                        @if (Model.Denizler1Data != null && Model.Denizler1Data.Any())
                                        {
                                            @foreach (var item in Model.Denizler1Data)
                                            {
                                                <tr>
                                                    <th>Gidilen Sefer Sayısı</th>
                                                    <td class="tooltip-cell" style="text-align: right" title="@item.GidilenSeferSayısı">@item.GidilenSeferSayısı.ToString("N2", new System.Globalization.CultureInfo("tr-TR"))</td>
                                                </tr>
                                                <tr>
                                                    <th>Taşınan Tonaj</th>
                                                    <td class="tooltip-cell" style="text-align: right" title="@item.TaşınanTonaj">@item.TaşınanTonaj.ToString("N2", new System.Globalization.CultureInfo("tr-TR"))</td>
                                                </tr>
                                                <tr>
                                                    <th>Kullanılan Yakıt Litre</th>
                                                    <td class="tooltip-cell" style="text-align: right" title="@item.KullanılanYakıtLitre">@item.KullanılanYakıtLitre.ToString("N2", new System.Globalization.CultureInfo("tr-TR"))</td>
                                                </tr>
                                                <tr>
                                                    <th>Depo Mazot Gideri</th>
                                                    <td class="tooltip-cell" style="text-align: right" title="@item.KullanılanYakıtTutarı">@string.Format("{0:N2}₺", item.KullanılanYakıtTutarı)</td>
                                                </tr>
                                                <tr>
                                                    <th>Depo Yedek Parça + Mazot Gider Toplamı</th>
                                                    <td class="tooltip-cell" style="text-align: right" title="@item.StoktaKullanılan">@string.Format("{0:N2}₺", item.StoktaKullanılan)</td>
                                                </tr>
                                                <tr>
                                                    <th>Sanayi Yedek Parça Gideri</th>
                                                    <td class="tooltip-cell" style="text-align: right" title="@item.SanayideYapilan">@string.Format("{0:N2}₺", item.SanayideYapilan)</td>
                                                </tr>
                                                <tr>
                                                    <th>Depo Yedek Parça Gideri</th>
                                                    <td class="tooltip-cell" style="text-align: right" title="@item.MazotHariçStoktaKullanılan">@string.Format("{0:N2}₺", item.MazotHariçStoktaKullanılan)</td>
                                                </tr>
                                                <tr>
                                                    <th>Tüm Giderler Toplamı</th>
                                                    <td class="tooltip-cell" style="text-align: right" title="@item.TümGiderler">@string.Format("{0:N2}₺", item.TümGiderler)</td>
                                                </tr>
                                                <tr>
                                                    <th>Nakliye Ciro Bedeli</th>
                                                    <td class="tooltip-cell" style="text-align: right" title="@item.NakliyeCiroBedeli">@string.Format("{0:N2}₺", item.NakliyeCiroBedeli)</td>
                                                </tr>
                                                <tr>
                                                    <th>Bir Saat Km'de Yakıt Litre Tutarı</th>
                                                    <td class="tooltip-cell" style="text-align: right" title="@item.BirSaatKmYapılanYakıtLitresiTutar">@string.Format("{0:N2}₺", item.BirSaatKmYapılanYakıtLitresiTutar)</td>
                                                </tr>
                                                <tr>
                                                    <th>Çalışma Saati Yapılan KM</th>
                                                    <td class="tooltip-cell" style="text-align: right" title="@item.ÇalışmaSaatiYapılanKM">@item.ÇalışmaSaatiYapılanKM.ToString("N2", new System.Globalization.CultureInfo("tr-TR"))</td>
                                                </tr>
                                                <tr>
                                                    <th>Km'de yakılan Yakıt Oranı</th>
                                                    <td class="tooltip-cell" style="text-align: right" title="@item.BirSaatKMYapılanYakıtLitresi">@item.BirSaatKMYapılanYakıtLitresi.ToString("N2", new System.Globalization.CultureInfo("tr-TR"))</td>
                                                </tr>
                                                <tr>
                                                    <th>Bir Saatte Yakılan Yakıt</th>
                                                    <td class="tooltip-cell" style="text-align: right" title="@item.BirSaatKMYakılanYakıtLitreOran">@item.BirSaatKMYakılanYakıtLitreOran.ToString("N2", new System.Globalization.CultureInfo("tr-TR"))</td>
                                                </tr>
                                            }
                                        }
                                        else
                                        {
                                            <tr>
                                                <th>Gidilen Sefer Sayısı</th>
                                                <td class="tooltip-cell" style="text-align: right">0,00</td>
                                            </tr>
                                            <tr>
                                                <th>Taşınan Tonaj</th>
                                                <td class="tooltip-cell" style="text-align: right">0,00</td>
                                            </tr>
                                            <tr>
                                                <th>Kullanılan Yakıt Litre</th>
                                                <td class="tooltip-cell" style="text-align: right">0,00</td>
                                            </tr>
                                            <tr>
                                                <th>Depo Mazot Gideri</th>
                                                <td class="tooltip-cell" style="text-align: right">0,00₺</td>
                                            </tr>
                                            <tr>
                                                <th>Depo Yedek Parça + Mazot Gider Toplamı</th>
                                                <td class="tooltip-cell" style="text-align: right">0,00₺</td>
                                            </tr>
                                            <tr>
                                                <th>Sanayi Yedek Parça Gideri</th>
                                                <td class="tooltip-cell" style="text-align: right">0,00₺</td>
                                            </tr>
                                            <tr>
                                                <th>Depo Yedek Parça Gideri</th>
                                                <td class="tooltip-cell" style="text-align: right">0,00₺</td>
                                            </tr>
                                            <tr>
                                                <th>Tüm Giderler Toplamı</th>
                                                <td class="tooltip-cell" style="text-align: right">0,00₺</td>
                                            </tr>
                                            <tr>
                                                <th>Nakliye Ciro Bedeli</th>
                                                <td class="tooltip-cell" style="text-align: right">0,00₺</td>
                                            </tr>
                                            <tr>
                                                <th>Bir Saat Km'de Yakıt Litre Tutarı</th>
                                                <td class="tooltip-cell" style="text-align: right">0,00₺</td>
                                            </tr>
                                            <tr>
                                                <th>Çalışma Saati Yapılan KM</th>
                                                <td class="tooltip-cell" style="text-align: right">0,00</td>
                                            </tr>
                                            <tr>
                                                <th>Km'de yakılan Yakıt Oranı</th>
                                                <td class="tooltip-cell" style="text-align: right">0,00</td>
                                            </tr>
                                            <tr>
                                                <th>Bir Saatte Yakılan Yakıt</th>
                                                <td class="tooltip-cell" style="text-align: right">0,00</td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                            <div class="table-responsive">
                                <h5>Araç Bilgileri</h5>
                                <table id="denizler_srm_tablo" class="table table-bordered table-striped tablo-th-baslik">
                                    <tbody>
                                        @if (Model.SorumlulukUserData != null && Model.SorumlulukUserData.Any())
                                        {
                                            @foreach (var item in Model.SorumlulukUserData)
                                            {
                                                <tr>
                                                    <th>Firma Adı</th>
                                                    <td class="tooltip-cell" title="@item.Firma_Adi">@item.Firma_Adi</td>
                                                </tr>
                                                <tr>
                                                    <th>Araç Marka</th>
                                                    <td class="tooltip-cell" title="@item.Arac_Marka">@item.Arac_Marka</td>
                                                </tr>
                                                <tr>
                                                    <th>Araç Modeli</th>
                                                    <td class="tooltip-cell" title="@item.Arac_Modeli">@item.Arac_Modeli</td>
                                                </tr>
                                                <tr>
                                                    <th>Araç Model Yılı</th>
                                                    <td class="tooltip-cell" title="@item.Arac_Model_Yili">@item.Arac_Model_Yili</td>
                                                </tr>
                                                <tr>
                                                    <th>Ruhsat Seri No</th>
                                                    <td class="tooltip-cell" title="@item.Ruhsat_Seri_No">@item.Ruhsat_Seri_No</td>
                                                </tr>
                                                <tr>
                                                    <th>Şase No</th>
                                                    <td class="tooltip-cell" title="@item.Sase_No">@item.Sase_No</td>
                                                </tr>
                                                <tr>
                                                    <th>Muayene Bitiş Tarihi</th>
                                                    <td class="tooltip-cell" title="@item.Muayene_Bitis_Tarihi">@item.Muayene_Bitis_Tarihi</td>
                                                </tr>
                                                <tr>
                                                    <th>Kullanıcı Adı</th>
                                                    <td class="tooltip-cell" title="@item.Kullanici_Adi">@item.Kullanici_Adi</td>
                                                </tr>
                                                <tr>
                                                    <th>Kullanıcı Adı (İkinci)</th>
                                                    <td class="tooltip-cell" title="@item.Kullanici_Adi__2__">@item.Kullanici_Adi__2__</td>
                                                </tr>
                                            }
                                        }
                                        else
                                        {
                                            <tr>
                                                <th>Firma Adı</th>
                                                <td class="tooltip-cell">Veri yok</td>
                                            </tr>
                                            <tr>
                                                <th>Araç Marka</th>
                                                <td class="tooltip-cell">Veri yok</td>
                                            </tr>
                                            <tr>
                                                <th>Araç Modeli</th>
                                                <td class="tooltip-cell">Veri yok</td>
                                            </tr>
                                            <tr>
                                                <th>Araç Model Yılı</th>
                                                <td class="tooltip-cell">Veri yok</td>
                                            </tr>
                                            <tr>
                                                <th>Ruhsat Seri No</th>
                                                <td class="tooltip-cell">Veri yok</td>
                                            </tr>
                                            <tr>
                                                <th>Şase No</th>
                                                <td class="tooltip-cell">Veri yok</td>
                                            </tr>
                                            <tr>
                                                <th>Muayene Bitiş Tarihi</th>
                                                <td class="tooltip-cell">Veri yok</td>
                                            </tr>
                                            <tr>
                                                <th>Kullanıcı Adı</th>
                                                <td class="tooltip-cell">Veri yok</td>
                                            </tr>
                                            <tr>
                                                <th>Kullanıcı Adı (İkinci)</th>
                                                <td class="tooltip-cell">Veri yok</td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                                <div class="col">
                                    <div class="table-container">
                                        <div class="table-responsive" style="margin: 0; padding: 0;">
                                            <h5>Kar-Zarar</h5>
                                            <table id="denizlertablo" class="table table-bordered table-striped table-sm">
                                                <tbody>
                                                    <tr>
                                                        <td><strong>Gelir Toplamı:</strong></td>
                                                        <td class="tooltip-cell" style="text-align: right" title="@gelir">@string.Format("{0:N2}₺", gelir)</td>
                                                    </tr>
                                                    <tr>
                                                        <td><strong>Gider Toplamı:</strong></td>
                                                        <td class="tooltip-cell" style="text-align: right" title="@gider">@string.Format("{0:N2}₺", gider)</td>
                                                    </tr>
                                                    <tr>
                                                        <td><strong>Sonuç:</strong></td>
                                                        <td class="tooltip-cell" style="text-align: right" title="@sonuc">@string.Format("{0:N2}₺", sonuc)</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body px-5">
                        <div class="row">
                            <div class="col-md-6 mb-4" style="page-break-before: always;">
                                <h5 class="pb-3">Sanayide Yapılan</h5>
                                <div class="table-responsive">
                                    <table id="denizler2tablo" class="table table-bordered table-striped">
                                        <thead>
                                            <tr>
                                                <th>Tarih</th>
                                                <th>Açıklama</th>
                                                <th>Masraf Adı</th>
                                                <th>Miktar</th>
                                                <th>Tutar</th>
                                            </tr>
                                            <tr>
                                                <th><input type="text" class="form-control form-control-sm filtre" placeholder="Tarih Ara" onkeyup="filterTable(0, 'denizler2tablo')"></th>
                                                <th><input type="text" class="form-control form-control-sm filtre" placeholder="Açıklama Ara" onkeyup="filterTable(1, 'denizler2tablo')"></th>
                                                <th><input type="text" class="form-control form-control-sm filtre" placeholder="Masraf Adı Ara" onkeyup="filterTable(2, 'denizler2tablo')"></th>
                                                <th><input type="text" class="form-control form-control-sm filtre" placeholder="Miktar Ara" onkeyup="filterTable(3, 'denizler2tablo')"></th>
                                                <th><input type="text" class="form-control form-control-sm filtre" placeholder="Tutar Ara" onkeyup="filterTable(4, 'denizler2tablo')"></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var item in Model.Denizler2Data)
                                            {
                                                <tr>
                                                    <td>@item.Tarih.ToShortDateString()</td>
                                                    <td class="column-width tooltip-cell" title="@item.Açıklama">@item.Açıklama</td>
                                                    <td class="column-width tooltip-cell" title="@item.MasrafAdı">@item.MasrafAdı</td>
                                                    <td class="column-width tooltip-cell" style="text-align: right" title="@item.Miktar">@item.Miktar.ToString("N2", new System.Globalization.CultureInfo("tr-TR"))</td>
                                                    <td class="column-width tooltip-cell" style="text-align: right" title="@item.Tutar">@string.Format("{0:N2}₺", item.Tutar)</td>
                                                </tr>
                                            }
                                            <tr>
                                                <td colspan="3" style="text-align: right;"><strong>Toplam:</strong></td>
                                                <td style="text-align: right;">
                                                    <strong>
                                                        @Model.Denizler2Data.Sum(x => x.Miktar).ToString("N2", new System.Globalization.CultureInfo("tr-TR"))
                                                    </strong>
                                                </td>
                                                <td style="text-align: right;">
                                                    <strong>
                                                        @string.Format("{0:N2}₺", Model.Denizler2Data.Sum(x => x.Tutar))
                                                    </strong>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="col-md-6 mb-4" style="page-break-before: always;">
                                <h5 class="pb-3">Stokta Kullanılan</h5>
                                <div class="table-responsive">
                                    <table id="denizler3tablo" class="table table-bordered table-striped">
                                        <thead>
                                            <tr>
                                                <th>Tarih</th>
                                                <th>Açıklama</th>
                                                <th>Stok Adı</th>
                                                <th>Miktar</th>
                                                <th>Tutar</th>
                                            </tr>
                                            <tr>
                                                <th><input type="text" class="form-control form-control-sm filtre" placeholder="Tarih Ara" onkeyup="filterTable(0, 'denizler3tablo')"></th>
                                                <th><input type="text" class="form-control form-control-sm filtre" placeholder="Açıklama Ara" onkeyup="filterTable(1, 'denizler3tablo')"></th>
                                                <th><input type="text" class="form-control form-control-sm filtre" placeholder="Stok Adı Ara" onkeyup="filterTable(2, 'denizler3tablo')"></th>
                                                <th><input type="text" class="form-control form-control-sm filtre" placeholder="Miktar Ara" onkeyup="filterTable(3, 'denizler3tablo')"></th>
                                                <th><input type="text" class="form-control form-control-sm filtre" placeholder="Tutar Ara" onkeyup="filterTable(4, 'denizler3tablo')"></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var item in Model.Denizler3Data)
                                            {
                                                <tr>
                                                    <td>@item.Tarih.ToShortDateString()</td>
                                                    <td class="column-width tooltip-cell" title="@item.Açıklama">@item.Açıklama</td>
                                                    <td class="column-width stok-adi-column tooltip-cell" title="@item.StokAdı">@item.StokAdı</td>
                                                    <td class="column-width tooltip-cell" style="text-align: right" title="@item.Miktar">@item.Miktar.ToString("N2", new System.Globalization.CultureInfo("tr-TR"))</td>
                                                    <td class="column-width tooltip-cell" style="text-align: right" title="@item.Tutar">@string.Format("{0:N2}₺", item.Tutar)</td>
                                                </tr>
                                            }
                                            <tr>
                                                <td colspan="3" style="text-align: right;"><strong>Toplam:</strong></td>
                                                <td style="text-align: right;">
                                                    <strong>
                                                        @Model.Denizler3Data.Sum(x => x.Miktar).ToString("N2", new System.Globalization.CultureInfo("tr-TR"))
                                                    </strong>
                                                </td>
                                                <td style="text-align: right;">
                                                    <strong>
                                                        @string.Format("{0:N2}₺", Model.Denizler3Data.Sum(x => x.Tutar))
                                                    </strong>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="col-md-6 mb-4" style="page-break-before: always;"></div>
                        </div>
                    </div>
                    }
                    else
                    {
                    <div class="alert alert-warning" role="alert">
                        Veri bulunamadı. Lütfen tarih aralığını girip tekrar deneyin.
                    </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.3/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.flash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.print.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script>
        $(document).ready(function () {
            // DataTable başlatma
            $('#denizler1tablo, #denizler2tablo').DataTable({
                responsive: true,
                dom: '<"row"<"col-sm-12"B>>' +
                    '<"row"<"col-sm-6"l><"col-sm-6"f>>' +
                    't' +
                    '<"row"<"col-sm-6"i><"col-sm-6"p>>',
                language: {
                    url: "/Content/DataTables/turkish.json"
                },
                buttons: [
                    'copy', 'csv', 'excel', 'pdf', 'print'
                ],
                paging: true,
                searching: true,
                ordering: true
            });

            // Select2 başlatma
            $('#projeKoduInput').select2({
                placeholder: "Proje kodu ara...",
                allowClear: true
            });

            $('#srmKodu').select2({
                placeholder: "Sorumlu kodu ara...",
                allowClear: true,
                dropdownParent: $('.form-group') // Select2 açılır menüsünün doğru konumda görünmesi için
            });
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('veri');
            const baslamaTarihi = document.getElementById('baslamaTarihi');
            const bitisTarihi = document.getElementById('bitisTarihi');
            const projeKoduInput = document.getElementById('projeKoduInput');
            const srmKodu = document.getElementById('srmKodu');
            const resetButton = document.getElementById('resetButton');

            // URL parametrelerini al ve formu doldur
            const urlParams = new URLSearchParams(window.location.search);
            const savedProjeKodu = urlParams.get('projeKodu') || localStorage.getItem('projeKodu');
            const savedSrmKodu = urlParams.get('srmKodu') || localStorage.getItem('srmKodu');

            if (savedProjeKodu) {
                projeKoduInput.value = savedProjeKodu;
                $(projeKoduInput).trigger('change'); // Select2 için tetikleme
            }

            if (savedSrmKodu) {
                srmKodu.value = savedSrmKodu;
                $(srmKodu).trigger('change'); // Select2 için tetikleme
            }

            // Form değerlerini kaydet
            function saveFormValues() {
                const formValues = {
                    baslamaTarihi: baslamaTarihi.value,
                    bitisTarihi: bitisTarihi.value,
                    projeKodu: projeKoduInput.value,
                    srmKodu: srmKodu.value
                };
                localStorage.setItem('formValues', JSON.stringify(formValues));
                localStorage.setItem('projeKodu', projeKoduInput.value);
                localStorage.setItem('srmKodu', srmKodu.value);

                // URL parametrelerini güncelle
                const url = new URL(window.location);
                url.searchParams.set('projeKodu', projeKoduInput.value);
                url.searchParams.set('srmKodu', srmKodu.value);
                window.history.replaceState({}, '', url);
            }

            // Form gönderildiğinde kaydet
            form.addEventListener('submit', function (e) {
                saveFormValues();
            });

            // Değerler değiştiğinde kaydet
            [baslamaTarihi, bitisTarihi, projeKoduInput, srmKodu].forEach(element => {
                if (element) {
                    element.addEventListener('change', saveFormValues);
                }
            });

            // Select2 değişikliğinde kaydet
            $(srmKodu).on('select2:select', function () {
                saveFormValues();
            });

            $(projeKoduInput).on('select2:select', function () {
                saveFormValues();
            });

            // Formu sıfırla
            resetButton.addEventListener('click', function () {
                localStorage.removeItem('formValues');
                localStorage.removeItem('projeKodu');
                localStorage.removeItem('srmKodu');
                form.reset();
                $(projeKoduInput).val(null).trigger('change');
                $(srmKodu).val(null).trigger('change');
                const url = new URL(window.location);
                url.searchParams.delete('projeKodu');
                url.searchParams.delete('srmKodu');
                window.history.replaceState({}, '', url);
            });
        });

        function printPage() {
            const srmKoduInput = document.getElementById('srmKodu');
            const srmKoduList = document.getElementById('srmKoduList');
            const selectedValue = srmKoduInput.value;

            const selectedOption = Array.from(srmKoduList.options).find(option => option.value === selectedValue);
            const selectedText = selectedOption ? selectedOption.text : selectedValue || 'Seçilmedi';

            let printContents = '';

            printContents += '<div style="text-align: center; font-weight: bold; font-size: 8pt; color: #1E3A8A; margin-bottom: 10px;">SEÇİLMİŞ OLAN SORUMLULUK KODU: ' + selectedText + '</div>';

            const baslamaTarihi = document.getElementById('baslamaTarihi').value;
            const bitisTarihi = document.getElementById('bitisTarihi').value;
            const projeKodu = document.getElementById('projeKoduInput').value || 'Seçilmedi';

            printContents += '<p style="font-size: 6pt; color: #374151;"><strong>Rapor Başlangıç-Bitiş Tarihi:</strong> ' + baslamaTarihi + " / " + bitisTarihi + '</p>';
            printContents += '<p style="font-size: 6pt; color: #374151;"><strong>Proje Kodu:</strong> ' + projeKodu + '</p>';

            printContents += `<style>
                table {
                    width: 100%;
                    font-size: 8px; /* Font boyutu 8px olarak güncellendi */
                    font-family: Arial, sans-serif;
                    border-collapse: collapse;
                    table-layout: fixed;
                }
                td, th {
                    padding: 2px 5px;
                    line-height: 1.2;
                    border: 1px solid #E5E7EB;
                }
                th {
                    background-color: #F3F4F6;
                    color: #1E3A8A;
                    font-weight: bold;
                }
                .table-striped > tbody > tr:last-child {
                    background-color: #FFF7ED;
                    font-weight: bold;
                }
                .table-striped > tbody > tr:last-child td {
                    color: #B8860B;
                }
            </style>`;

            const denizlerTablo = document.getElementById('denizlertablo');
            if (denizlerTablo) {
                printContents += '<h5 style="color: #B8860B; font-size: 2pt; ">Gelir Gider Tabloları</h5>' + denizlerTablo.outerHTML;
            }

            const denizlerSrmTablo = document.getElementById('denizler_srm_tablo');
            if (denizlerSrmTablo) {
                printContents += '<h5 style="color: #B8860B; font-size: 2pt; ">Sorumluluk Merkezi Verileri</h5>' + denizlerSrmTablo.outerHTML;
            }

            const denizler1Tablolar = document.querySelectorAll('#denizler1tablo');
            denizler1Tablolar.forEach(function (tablo) {
                printContents += '<h5 style="color: #B8860B; font-size: 2pt; ">Araç Özeti</h5>' + tablo.outerHTML;
            });

            const denizler2Tablo = document.getElementById('denizler2tablo');
            if (denizler2Tablo) {
                printContents += '<h3 style="color: #1E3A8A; font-size: 8pt; margin: 10px 0 5px;">Sanayide Yapılan</h3>' + denizler2Tablo.outerHTML;
            }

            const denizler3Tablo = document.getElementById('denizler3tablo');
            if (denizler3Tablo) {
                printContents += '<h3 style="color: #1E3A8A; font-size: 8pt; margin: 10px 0 5px;">Stokta Kullanılan</h3>' + denizler3Tablo.outerHTML;
            }

            const originalContents = document.body.innerHTML;
            document.body.innerHTML = printContents;
            window.print();
            document.body.innerHTML = originalContents;

            // Form değerlerini geri yükle
            const savedProjeKodu = localStorage.getItem('projeKodu');
            const savedSrmKodu = localStorage.getItem('srmKodu');
            if (savedProjeKodu) {
                projeKoduInput.value = savedProjeKodu;
                $(projeKoduInput).trigger('change');
            }
            if (savedSrmKodu) {
                srmKodu.value = savedSrmKodu;
                $(srmKodu).trigger('change');
            }
        }

        function filterTable(columnIndex, tableId) {
            const input = document.querySelectorAll("#" + tableId + " thead tr:nth-child(2) th input")[columnIndex];
            const filter = input.value.toUpperCase();
            const table = document.getElementById(tableId);
            const tr = table.getElementsByTagName("tr");
            let visibleRows = [];

            for (let i = 2; i < tr.length - 1; i++) {
                const td = tr[i].getElementsByTagName("td")[columnIndex];
                if (td) {
                    const txtValue = td.textContent || td.innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                        visibleRows.push(tr[i]);
                    } else {
                        tr[i].style.display = "none";
                    }
                }
            }

            updateSubtotals(tableId, visibleRows);
        }

        function updateSubtotals(tableId, visibleRows) {
            const table = document.getElementById(tableId);
            const totalRow = table.rows[table.rows.length - 1];

            if (tableId === 'denizler2tablo' || tableId === 'denizler3tablo') {
                let totalMiktar = 0;
                let totalTutar = 0;

                for (let i = 0; i < visibleRows.length; i++) {
                    const row = visibleRows[i];
                    const miktarCell = row.cells[3];
                    const tutarCell = row.cells[4];

                    const miktarValue = parseFloat(miktarCell.textContent.replace(/\./g, '').replace(',', '.'));
                    const tutarValue = parseFloat(tutarCell.textContent.replace('₺', '').replace(/\./g, '').replace(',', '.'));

                    if (!isNaN(miktarValue)) totalMiktar += miktarValue;
                    if (!isNaN(tutarValue)) totalTutar += tutarValue;
                }

                const totalMiktarCell = totalRow.cells[totalRow.cells.length - 2];
                const totalTutarCell = totalRow.cells[totalRow.cells.length - 1];

                totalMiktarCell.innerHTML = '<strong>' + totalMiktar.toLocaleString('tr-TR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + '</strong>';
                totalTutarCell.innerHTML = '<strong>' + totalTutar.toLocaleString('tr-TR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + '₺</strong>';

                if (visibleRows.length === 0) {
                    totalMiktarCell.innerHTML = '<strong>0,00</strong>';
                    totalTutarCell.innerHTML = '<strong>0,00₺</strong>';
                }
            }
        }
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tables = ['denizler2tablo', 'denizler3tablo'];

            tables.forEach(function(tableId) {
                const table = document.getElementById(tableId);
                if (!table) return;

                const filterInputs = table.querySelectorAll('thead tr:nth-child(2) th input');

                filterInputs.forEach(function(input, columnIndex) {
                    input.addEventListener('keyup', function() {
                        applyMultipleFilters(tableId);
                    });
                });
            });

            function applyMultipleFilters(tableId) {
                const table = document.getElementById(tableId);
                const filterInputs = table.querySelectorAll('thead tr:nth-child(2) th input');
                const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');

                const totalRow = rows[rows.length - 1];
                const dataRows = Array.from(rows).slice(0, -1);
                let visibleRows = dataRows;

                filterInputs.forEach((input, columnIndex) => {
                    const filterValue = input.value.toUpperCase().trim();
                    if (filterValue) {
                        visibleRows = visibleRows.filter(row => {
                            const cell = row.getElementsByTagName('td')[columnIndex];
                            const cellText = cell.textContent.toUpperCase().trim();
                            return cellText.includes(filterValue);
                        });
                    }
                });

                dataRows.forEach(row => {
                    row.style.display = visibleRows.includes(row) ? '' : 'none';
                });

                updateSubtotals(tableId, visibleRows);
            }

            window.onbeforeprint = function () {
                const baslamaTarihi = document.getElementById('baslamaTarihi').value;
                const bitisTarihi = document.getElementById('bitisTarihi').value;
                const projeKodu = document.getElementById('projeKoduInput').value || 'Seçilmedi';
                const srmKodu = document.getElementById('srmKodu').value || 'Seçilmedi';

                const formatDate = (dateStr) => {
                    if (!dateStr) return '';
                    const date = new Date(dateStr);
                    return date.toLocaleDateString('tr-TR', { day: '2-digit', month: '2-digit', year: 'numeric' });
                };

                document.getElementById('printBaslamaTarihi').textContent = formatDate(baslamaTarihi);
                document.getElementById('printBitisTarihi').textContent = formatDate(bitisTarihi);
                document.getElementById('printProjeKodu').textContent = projeKodu;
                document.getElementById('printSrmKodu').textContent = srmKodu;
            };
        });
    </script>
